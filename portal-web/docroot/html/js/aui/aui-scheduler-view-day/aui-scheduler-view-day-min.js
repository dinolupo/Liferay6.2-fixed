YUI.add("aui-scheduler-view-day",function(e,t){var n=e.Lang,r=n.isBoolean,i=n.isFunction,s=n.isNumber,o=n.isObject,u=n.isString,a=e.DataType.DateMath,f=e.WidgetStdMod,l="a",c=",",h=".",p="",d="%",v=" ",m="data-colnumber",g="scheduler-view",y="scheduler-view-day",b=e.cached(function(){var t=e.config.doc,n=t.createElement("div"),r=t.getElementsByTagName("body")[0],i=.1;return r&&(n.style.cssText="position:absolute;visibility:hidden;overflow:scroll;width:20px;",n.appendChild(t.createElement("p")).style.height="1px",r.insertBefore(n,r.firstChild),i=n.offsetWidth-n.clientWidth,r.removeChild(n)),i},null,.1),w=function(e,t){return function(n){var r=n.all(e);return r.size()>=t?r:null}},E=function(e,t){return Math.round(e/t)*t},S=function(e){return parseFloat(e)||0},x="activeColumn",T="activeView",N="allDay",C="boundingBox",k="col",L="colDaysNode",A="colHeaderDaysNode",O="colblank",M="coldata",_="colday",D="colgrid",P="colspan",H="coltime",B="columnData",j="columnDayHeader",F="columnShims",I="columnTime",q="container",R="creationStartDate",U="data",z="date",W="day",X="days",V="delegateConfig",$="disabled",J="division",K="draggingEvent",Q="duration",G="endDate",Y="eventPlaceholder",Z="eventRecorder",et="eventWidth",tt="filterFn",nt="first",rt="grid",it="gridContainer",st="grip",ot="hd",ut="header",at="headerDateFormatter",ft="headerTableNode",lt="headerView",ct="headerViewConfig",ht="headerViewLabelNode",pt="height",dt="horizontal",vt="host",mt="hourHeight",gt="icon",yt="intersecting",bt="isoTime",wt="label",Et="left",St="locale",xt="paddingRight",Tt="region",Nt="resizer",Ct="resizerNode",kt="resizing",Lt="scheduler",At="scheduler-event",Ot="shim",Mt="startDate",_t="startXY",Dt="strings",Pt="table",Ht="tableNode",Bt="time",jt="timesNode",Ft="today",It="todayDate",qt="top",Rt="view",Ut="viewDate",zt="visible",Wt="width",Xt="marker",Vt="markercell",$t="markercellsNode",Jt="markers",Kt="markersNode",Qt="node",Gt="offsetHeight",Yt="parentNode",Zt="proxy",en="px",tn=e.getClassName,nn=tn(g,Pt,U),rn=tn(At),sn=tn(At,$),on=tn(At,yt),un=tn(At,Zt),an=tn(Lt,Ft),fn=tn(Lt,Ft,ot),ln=tn(g,M),cn=tn(g,D),hn=tn(g,rt),pn=tn(g,rt,q),dn=tn(g,W,ut,k),vn=tn(g,W,ut,W),mn=tn(g,W,ut,W,nt),gn=tn(g,W,ut,Pt),yn=tn(g,W,ut,Rt,wt),bn=tn(g,gt,st,dt),wn=tn(g,Xt,J),En=tn(g,Vt),Sn=tn(g,Jt),xn=tn(g,W,Nt),Tn=tn(g,W,Nt,gt),Nn=tn(g,W,Pt),Cn=tn(g,W,Pt,k),kn=tn(g,W,Pt,k,Ot),Ln=tn(g,W,Pt,O),An=tn(g,W,Pt,_),On=tn(g,W,Pt,H),Mn=tn(g,W,Pt,Bt),_n='<div class="'+xn+'">'+'<div class="'+[bn,Tn].join(v)+'"></div>'+"</div>",Dn='<div class="'+En+'">'+'<div class="'+wn+'"></div>'+"</div>",Pn='<span class="'+yn+'">{label}</span>',Hn='<table cellspacing="0" cellpadding="0" class="'+Nn+'">'+"<tbody>"+'<tr class="'+cn+'" height="1">'+'<td height="0" class="'+[Cn,Ln].join(v)+'"></td>'+'<td class="'+pn+'" colspan="1">'+'<div class="'+hn+'">'+'<div class="'+Sn+'"></div>'+"</div>"+"</td>"+"</tr>"+'<tr class="'+ln+'">'+'<td class="'+[Cn,On].join(v)+'"></td>'+"</tr>"+"</tbody>"+"</table>",Bn='<td class="'+[Cn,An].join(v)+'" data-colnumber="{colNumber}">'+'<div class="'+kn+'">&nbsp;</div>'+"</td>",jn='<div class="'+Mn+'">{hour}</div>',Fn='<table cellspacing="0" cellpadding="0" class="'+gn+'">'+"<tbody>"+'<tr class="'+dn+'"></tr>'+"</tbody>"+"</table>",In='<th class="'+vn+'" data-colnumber="{colNumber}"><a href="#">&nbsp;</a></th>',qn='<td class="'+[vn,mn].join(v)+'"></td>',Rn=e.Component.create({NAME:y,ATTRS:{bodyContent:{value:p},days:{value:1,validator:s},delegateConfig:{value:{},setter:function(t){var n=this;return e.merge({dragConfig:{useShim:!1},bubbleTargets:n,container:n.get(C),nodes:h+rn,invalid:"input, select, button, a, textarea, "+h+sn},t||{})},validator:o},eventWidth:{value:95,validator:s},filterFn:{value:function(e){return e.get(zt)&&e.getHoursDuration()<=24&&!e.get(N)}},headerDateFormatter:{value:function(t){var n=this,r=n.get(Lt);return e.DataType.Date.format(t,{format:"<span>%d</span> %a",locale:r.get(St)})},validator:u},headerView:{value:!0,validator:r},headerViewConfig:{setter:function(t){var n=this;return e.merge({displayDaysInterval:1,displayRows:6,filterFn:function(e){return e.getHoursDuration()>24||e.get(N)},height:"auto",visible:!0},t||{})},value:{}},hourHeight:{value:52,validator:s},name:{value:W},navigationDateFormatter:{value:function(t){var n=this,r=n.get(Lt);return e.DataType.Date.format(t,{format:"%A, %B %d, %Y",locale:r.get(St)})},validator:i},strings:{value:{allDay:"All day"}},headerTableNode:{valueFn:function(){return e.Node.create(Fn)}},headerViewLabelNode:{valueFn:function(){var t=this,r=t.get(Dt);return e.Node.create(n.sub(Pn,{label:r[N]}))}},resizerNode:{valueFn:function(){return e.Node.create(_n)}},tableNode:{valueFn:function(){return e.Node.create(Hn)}},colDaysNode:{valueFn:"_valueColDaysNode"},colHeaderDaysNode:{valueFn:"_valueColHeaderDaysNode"},markercellsNode:{valueFn:"_valueMarkercellsNode"},timesNode:{valueFn:"_valueTimesNode"}},HTML_PARSER:{colDaysNode:w(h+An,1),colHeaderDaysNode:w(h+vn,2),headerTableNode:h+gn,headerViewLabelNode:h+yn,markercellsNode:w(h+En,24),resizerNode:h+xn,tableNode:h+Nn,timesNode:w(h+Mn,24)},EXTENDS:e.SchedulerView,prototype:{initializer:function(){var t=this;t[L]=t.get(L),t[A]=t.get(A),t[ft]=t.get(ft),t[$t]=t.get($t),t[Ct]=t.get(Ct),t[Ht]=t.get(Ht),t[jt]=t.get(jt),t[x]=null,t[B]=t[Ht].one(h+ln),t[j]=t.headerTableNode.one(h+dn),t[F]=t[L].all(h+kn),t[I]=t[Ht].one(h+On),t[it]=t[Ht].one(h+pn),t[Kt]=t[Ht].one(h+Sn),t.get(lt)&&(t[lt]=new e.SchedulerTableView(t.get(ct)))},renderUI:function(){var e=this;e[I].setContent(e[jt]),e[Kt].setContent(e[$t]),e[L].appendTo(e[B]),e[A].appendTo(e[j]),e[lt]&&(e[lt].set(Lt,e.get(Lt)),e[lt].render())},bindUI:function(){var t=this;t[ft].delegate("click",e.bind(t._onClickDaysHeader,t),h+vn),t[B].delegate("mousedown",e.bind(t._onMouseDownTableCol,t),h+Cn),t[B].delegate("mouseenter",e.bind(t._onMouseEnterEvent,t),h+rn),t[B].delegate("mouseleave",e.bind(t._onMouseLeaveEvent,t),h+rn),t[B].delegate("mousemove",e.bind(t._onMouseMoveTableCol,t),h+An),t[B].delegate("mouseup",e.bind
(t._onMouseUpTableCol,t),h+Cn),t.on("drag:end",t._onEventDragEnd),t.on("drag:start",t._onEventDragStart),t.on("drag:tickAlignY",t._dragTickAlignY),t.on("schedulerChange",t._onSchedulerChange),t.after("drag:align",t._afterDragAlign)},syncUI:function(){var e=this;Rn.superclass.syncUI.apply(this,arguments),e[it].attr(P,e.get(X)),e._setupDragDrop()},syncStdContent:function(){var t=this;t.setStdModContent(f.BODY,t[Ht].getDOM());var n=e.NodeList.create(t[ft]);t[lt]&&(n.push(t[lt].get(C)),n.push(t.get(ht))),t.setStdModContent(f.HEADER,n)},calculateEventHeight:function(e){var t=this,n=t.get(mt);return Math.max(e*(n/60),n/2)},calculateTop:function(e){var t=this;return(e.getHours()*60+e.getMinutes()+e.getSeconds()/60)*(t.get(mt)/60)},getNextDate:function(){var e=this,t=e.get(Lt).get(Ut);return a.toLastHour(a.add(t,a.DAY,1))},getPrevDate:function(){var e=this,t=e.get(Lt).get(Ut);return a.toMidnight(a.subtract(t,a.DAY,1))},getColumnByDate:function(e){var t=this;return t[L].item(t.getDateDaysOffset(e))},getColumnShimByDate:function(e){var t=this;return t[F].item(t.getDateDaysOffset(e))},getDateByColumn:function(e){var t=this,n=a.safeClearTime(t.get(Lt).get(Ut));return a.add(n,a.DAY,e)},getDateDaysOffset:function(e){var t=this,n=a.safeClearTime(t.get(Lt).get(Ut));return a.getDayOffset(a.safeClearTime(e),n)},getYCoordTime:function(e){var t=this,n=t.get(mt),r=S((e/n).toFixed(2)),i=Math.floor(r*100%100*.6),s=Math.floor(r);return[s,i,0]},plotEvent:function(e){var t=this,n=e.get(Qt);n.size()<2&&e.addPaddingNode();var r=e.get(Qt).item(0),i=e.get(Qt).item(1),s=t.getColumnShimByDate(e.get(G)),o=t.getColumnShimByDate(e.get(Mt));o?(o.append(r),e.get(zt)&&r.show()):r.hide(),s?s.compareTo(o)||e.isDayBoundaryEvent()?i.hide():(s.append(i),e.get(zt)&&i.show()):i.hide(),e.syncUI(),t.syncEventTopUI(e),t.syncEventHeightUI(e)},plotEvents:function(){var t=this,n=t.get(Lt),r=t.get(tt);t.get(Lt).flushEvents(),t[F].each(function(i,s){var o=n.getEventsByDay(t.getDateByColumn(s),!0),u=[];i.empty(),e.Array.each(o,function(e){r.apply(t,[e])&&(t.plotEvent(e),u.push(e))}),t.syncEventsIntersectionUI(u)}),t.syncHeaderViewUI()},syncColumnsUI:function(){var e=this,t=e.get(Lt).get(It);e[L].each(function(n,r){var i=e.getDateByColumn(r);n.toggleClass(an,!a.isDayOverlap(i,t))})},syncDaysHeaderUI:function(){var e=this,t=e.get(Lt).get(Ut),n=e.get(at),r=e.get(St),i=e.get(Lt).get(It);e[A].all(l).each(function(r,s){var o=a.add(t,a.DAY,s);r.toggleClass(fn,!a.isDayOverlap(o,i)),r.html(n.call(e,o))})},syncEventsIntersectionUI:function(t){var n=this,r=[],i=n.get(et);e.Array.each(t,function(s){var o=n.findEventIntersections(s,t),u=0,a=o.length,f=i/a;e.Array.each(o,function(t){var n=t.get("clientId"),s=e.Array.indexOf(r,n);if(s===-1){s=0,t._filtered&&(s=1);var o=t.get(Qt).item(s),l=f*u,c=f*1.7;u===a-1&&(c=i-l),o.setStyle(Wt,c+d),o.setStyle(Et,l+d),a>1?o.addClass(on):o.removeClass(on);var h=o.get(Yt);h&&h.insert(o,u),t._filtered=!0,r.push(n),u+=1}})})},syncEventHeightUI:function(e){var t=this,n=e.get(G),r=e.get(Mt),i=a.clone(r);i.setHours(24,0,0);var s=a.getMinutesOffset(t.limitDate(n,i),r);e.get(Qt).item(0).set(Gt,t.calculateEventHeight(s));var o=e.get(Qt).item(1);if(o.inDoc()){var u=a.getMinutesOffset(n,a.toMidnight(e.getClearEndDate()));o.set(Gt,t.calculateEventHeight(u))}},syncEventTopUI:function(e){var t=this;e.get(Qt).item(0).setStyle(qt,t.calculateTop(e.get(Mt))+en),e.get(Qt).item(1).setStyle(qt,0)},syncHeaderViewUI:function(){var e=this;if(e.get(lt)){var t=e[lt];t.plotEvents(),e.headerNode.setStyle(xt,b());var n=t.get(C),r=n.one(h+nn),i=Math.max(r.get(Gt),40);t.set(pt,i),e._fillHeight()}},calculateYDelta:function(e,t){var n=this;return(t[1]-e[1])/(n.get(mt)/2)*30},findEventIntersections:function(t,n){var r=this,i=[];return e.Array.each(n,function(e){e.get(zt)&&t.intersects(e)&&i.push(e)}),i},getXYDelta:function(t){var n=this,r=t.currentTarget.getXY(),i=[t.pageX,t.pageY];return e.Array.map(r,function(e,t){return i[t]-e})},getTickY:function(){var e=this;return E(Math.ceil(e.get(mt)/2),10)},roundToNearestHour:function(e,t){var n=this;e.setHours(t[0],E(t[1],n.getTickY()),t[2])},_afterDragAlign:function(e){var t=this,n=e.target;t[_t]||(t[_t]=n.actXY),n.actXY[0]=null},_dragTickAlignX:function(e){var t=this,n=t[K];if(n&&!t[kt]){var r=t[Y],i=S(e.attr(m))-t.startColNumber;t.draggingEventStartDate=a.add(n.get(Mt),a.DAY,i);var s=a.clone(t.draggingEventStartDate);a.copyHours(s,r.get(Mt)),r.move(s,{silent:!0}),t.plotEvent(r)}},_dragTickAlignY:function(e){var t=this,n=t.get(Lt),r=n.get(Z),i=t[K];if(i){var s=e.target.get(vt),o=t[Y],u=t.calculateYDelta(t[_t],s.actXY);if(t[kt]){var f=a.add(t.draggingEventEndDate,a.MINUTES,u);if(a.getMinutesOffset(f,t.draggingEventStartDate)<30)return;o.set(G,f,{silent:!0})}else o.move(a.add(t.draggingEventStartDate,a.MINUTES,u),{silent:!0});t.plotEvent(o)}},_setupDragDrop:function(){var t=this,n=t[Y];if(!n){var r=t.get(Lt);n=new r.eventModel({scheduler:r}),n.removeTarget(r),n.get(Qt).addClass(un),n.set(zt,!1,{silent:!0}),t[Y]=n}t.delegate||(t.delegate=new e.DD.Delegate(t.get(V)));var i=t.delegate.dd;i.unplug(e.Plugin.DDConstrained),i.unplug(e.Plugin.DDNodeScroll);var s=t.bodyNode.get(Tt);s.bottom=Infinity,s.top=-Infinity,i.plug(e.Plugin.DDConstrained,{bubbleTargets:t,constrain:s,stickY:!0,tickY:t.get(mt)/2}),i.plug(e.Plugin.DDNodeScroll,{node:t.bodyNode,scrollDelay:150})},_uiSetDate:function(e){var t=this;t.syncColumnsUI(),t.syncDaysHeaderUI()},_onClickDaysHeader:function(e){var t=this,n=t.get(Lt);if(e.target.test("a, a span")){var r=n.getViewByName(W);if(r){var i=S(e.currentTarget.attr(m));n.set(z,t.getDateByColumn(i)),n.set(T,r)}}e.preventDefault()},_onEventDragEnd:function(e){var t=this,n=t[K];if(n){var r=t[Y];r.set(zt,!1,{silent:!0}),n.set(zt,!0,{silent:!0}),n.copyDates(r),t.get(Lt).syncEventsUI()}t[_t]=null,t[K]=null},_onEventDragStart:function(e){var t=this,n=t[K]=t.delegate.dd.get(Qt).getData(At);if(n){var r=t[Y];r.copyPropagateAttrValues(n,null,{silent:!0}),t.plotEvent(r),n.set(zt,!1,{silent:!0}),t.draggingEventStartDate=
a.clone(n.get(Mt)),t.draggingEventEndDate=a.clone(n.get(G));var i=t.getColumnByDate(n.get(Mt));t.startColNumber=i?S(i.attr(m)):0}},_onMouseDownTableCol:function(e){var t=this,n=e.target,r=t.get(Lt),i=r.get(Z);if(i&&!r.get($)){i.hidePopover();if(n.test(h+kn)){t[_t]=[e.pageX,e.pageY];var s=S(e.currentTarget.attr(m)),o=t.getDateByColumn(s),u=t.getXYDelta(e);t.roundToNearestHour(o,t.getYCoordTime(u[1]));var f=a.add(o,a.MINUTES,i.get(Q));i.move(o,{silent:!0}),i.setAttrs({allDay:!1,endDate:f},{silent:!0}),t[R]=o,e.halt()}else n.test([h+xn,h+Tn].join(c))&&(t[kt]=!0)}t.get(C).unselectable()},_onMouseEnterEvent:function(e){var t=this,n=e.currentTarget,r=n.getData(At);r&&!r.get($)&&t[Ct].appendTo(n)},_onMouseLeaveEvent:function(e){var t=this;t[kt]||t._removeResizer()},_onMouseMoveTableCol:function(e){var t=this,n=e.currentTarget,r=t.get(Lt).get(Z);t[x]!==n&&(t[x]=n,t._dragTickAlignX(t[x]));var i=t[R];if(i){var s=E(t.calculateYDelta(t[_t],[e.pageX,e.pageY]),t.getTickY()),o=s>=t._delta;if(t._delta!==s){if(s>0){var u=o?Math.max(s,r.get(Q)):s;r.set(G,a.add(i,a.MINUTES,u),{silent:!0})}else r.set(Mt,a.add(i,a.MINUTES,s),{silent:!0});t.plotEvent(r),t._delta=s}}},_onMouseUpTableCol:function(e){var t=this,n=t.get(Lt),r=n.get(Z);r&&!n.get($)&&t[R]&&(t.plotEvent(r),r.showPopover()),t[R]=null,t[kt]=!1,t[_t]=null,t._removeResizer(),t.get(C).selectable()},_onSchedulerChange:function(e){var t=this;t[lt]&&t[lt].set(Lt,e.newVal)},_removeResizer:function(){var e=this;e[Ct].remove()},_valueColDaysNode:function(){var t=this,n=t.get(X),r=[],i=0;while(n--)r.push(e.Lang.sub(Bn,{colNumber:i++}));return e.NodeList.create(r.join(p))},_valueColHeaderDaysNode:function(){var t=this,n=t.get(X),r=[],i=0;r.push(qn);while(n--)r.push(e.Lang.sub(In,{colNumber:i++}));return e.NodeList.create(r.join(p))},_valueMarkercellsNode:function(){var t=this,n=[],r;for(r=0;r<=23;r++)n.push(Dn);return e.NodeList.create(n.join(p))},_valueTimesNode:function(){var t=this,r=t.get(bt),i=[],s;for(s=0;s<=23;s++)i.push(n.sub(jn,{hour:r?a.toIsoTimeString(s):a.toUsTimeString(s,!1,!0)}));return e.NodeList.create(i.join(p))}}});e.SchedulerDayView=Rn},"2.0.0",{requires:["dd-drag","dd-delegate","dd-drop","dd-constrain","aui-scheduler-view-table"],skinnable:!0});
